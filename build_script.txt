
@echo off
setlocal
cd /d %~dp0

:: Check for Admin rights
net session >nul 2>&1
if %errorLevel% neq 0 (
    echo [ERROR] PLEASE RUN AS ADMINISTRATOR TO BYPASS SYSTEM BLOCKS
    pause
    exit /b
)

echo ----------------------------------------------------
echo STEP 1: CLEANING PREVIOUS BUILDS...
echo ----------------------------------------------------
if exist dist rmdir /s /q dist
if exist bundle.js del /f bundle.js

echo ----------------------------------------------------
echo STEP 2: FIXING NPM BLOCKS AND INSTALLING...
echo ----------------------------------------------------
call npm cache clean --force
call npm install --no-audit --no-fund

echo ----------------------------------------------------
echo STEP 3: BUNDLING REACT UI...
echo ----------------------------------------------------
call npx esbuild index.tsx --bundle --minify --outfile=bundle.js --format=iife --platform=browser --define:process.env.NODE_ENV=\"production\"

echo ----------------------------------------------------
echo STEP 4: COMPILING DESKTOP EXE...
echo ----------------------------------------------------
call npx electron-builder --win nsis

echo ----------------------------------------------------
echo BUILD SUCCESSFUL!
echo Opening 'dist' folder...
echo ----------------------------------------------------
if exist dist start dist
pause
